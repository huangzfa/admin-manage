<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.duobei.core.user.user.dao.UserDao">

  <sql id="Base_Column_List">
    user.id as id, user.product_id as product_id, user.app_id as app_id,
    user.global_user_id as global_user_id, user.user_name as user_name, user.user_name_md5 as user_name_md5,
    user.user_name_encrypt as user_name_encrypt, user.pwd as pwd, user.salt as salt,
    user.channel_id as channel_id, user.add_time as add_time, user.modify_time as modify_time,
    user.is_delete as is_delete
  </sql>

  <select id="getUserByMobileAndProductId" resultType="com.duobei.core.user.user.domain.vo.UserAndIdCardVo" >
    select <include refid="Base_Column_List"/> ,user_idcard.real_name,user_idcard.real_name_md5,user_idcard.real_name_encrypt
    from pgy_user `user`
    left join pgy_user_idcard user_idcard on `user`.id = user_idcard.user_id
    where `user`.is_delete = 0 and `user`.user_name_md5 = #{userName} and `user`.product_id = #{productId} limit 1

  </select>

  <select id="getUserAndIdCardMapByBorrowUserIds" resultType="com.duobei.core.user.user.domain.vo.UserAndIdCardVo">
    select <include refid="Base_Column_List"/> ,user_idcard.real_name,user_idcard.real_name_md5,user_idcard.real_name_encrypt
    from pgy_user `user`
    left join pgy_user_idcard user_idcard on `user`.id = user_idcard.user_id
    where  `user`.is_delete = 0 and `user`.id
    <foreach collection="borrowData" open=" in(" close=")" separator="," item="borrow">
      #{borrow.userId}
    </foreach>
  </select>

  <select id="getUserAndIdCardMapByRepaymentUserIds" resultType="com.duobei.core.user.user.domain.vo.UserAndIdCardVo">
    select <include refid="Base_Column_List"/> ,user_idcard.real_name,user_idcard.real_name_md5,user_idcard.real_name_encrypt
    from pgy_user `user`
    left join pgy_user_idcard user_idcard on `user`.id = user_idcard.user_id
    where  `user`.is_delete = 0 and `user`.id
    <foreach collection="repaymentData" open=" in(" close=")" separator="," item="repayment">
      #{repayment.userId}
    </foreach>
  </select>


  <select id="getUserInfoVoById" resultType="com.duobei.core.user.user.domain.vo.UserInfoVo" parameterType="Long">
    select <include refid="Base_Column_List"/> ,user_idcard.real_name,user_idcard.real_name_md5,user_idcard.real_name_encrypt
    from pgy_user `user`
    left join pgy_user_idcard user_idcard on `user`.id = user_idcard.user_id
    where  `user`.is_delete = 0 and `user`.id = #{userId}
  </select>

  <select id="getUserAndIdCardMapByRenelwalUserIds" resultType="com.duobei.core.user.user.domain.vo.UserAndIdCardVo">
    select <include refid="Base_Column_List"/> ,user_idcard.real_name,user_idcard.real_name_md5,user_idcard.real_name_encrypt
    from pgy_user `user`
    left join pgy_user_idcard user_idcard on `user`.id = user_idcard.user_id
    where  `user`.is_delete = 0 and `user`.id
    <foreach collection="renewalData" open=" in(" close=")" separator="," item="renewal">
      #{renewal.userId}
    </foreach>
  </select>
</mapper>